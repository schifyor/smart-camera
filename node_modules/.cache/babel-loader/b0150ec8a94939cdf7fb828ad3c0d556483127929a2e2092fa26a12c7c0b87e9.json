{"ast":null,"code":"var _jsxFileName = \"/home/yorick/my-page/src/components/objectDetector/index.tsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useState } from \"react\";\nimport \"@tensorflow/tfjs-backend-cpu\";\n// import \"@tensorflow/tfjs-backend-webgl\";\nimport * as cocoSsd from \"@tensorflow-models/coco-ssd\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function ObjectDetector() {\n  _s();\n  const fileInputRef = useRef(null);\n  const imageRef = useRef(null);\n  const [imgData, setImgData] = useState(null);\n  const [predictions, setPredictions] = useState([]);\n  const [isLoading, setLoading] = useState(false);\n  const isEmptyPredictions = !predictions || predictions.length === 0;\n  const openFilePicker = () => {\n    var _fileInputRef$current;\n    (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n  };\n  const normalizePredictions = (predictions, imgSize) => {\n    if (!predictions || !imgSize || !imageRef.current) return [];\n    const imgWidth = imageRef.current.width;\n    const imgHeight = imageRef.current.height;\n    return predictions.map(prediction => {\n      const [oldX, oldY, oldWidth, oldHeight] = prediction.bbox;\n      const x = oldX * imgWidth / imgSize.width;\n      const y = oldY * imgHeight / imgSize.height;\n      const width = oldWidth * imgWidth / imgSize.width;\n      const height = oldHeight * imgHeight / imgSize.height;\n      return {\n        class: prediction.class,\n        score: prediction.score,\n        bbox: [x, y, width, height]\n      };\n    });\n  };\n  const detectObjectsOnImage = async (imageElement, imgSize) => {\n    const model = await cocoSsd.load();\n    const predictions = await model.detect(imageElement, 6);\n    const normalized = normalizePredictions(predictions, imgSize);\n    setPredictions(normalized);\n    console.log(\"Predictions: \", predictions);\n  };\n  const readImage = file => {\n    return new Promise((resolve, reject) => {\n      const fileReader = new FileReader();\n      fileReader.onload = () => resolve(fileReader.result);\n      fileReader.onerror = () => reject(fileReader.error);\n      fileReader.readAsDataURL(file);\n    });\n  };\n  const onSelectImage = async e => {\n    var _e$target$files;\n    setPredictions([]);\n    setLoading(true);\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!file) return;\n    const imgData = await readImage(file);\n    setImgData(imgData);\n    const imageElement = document.createElement(\"img\");\n    imageElement.src = imgData;\n    imageElement.onload = async () => {\n      const imgSize = {\n        width: imageElement.width,\n        height: imageElement.height\n      };\n      await detectObjectsOnImage(imageElement, imgSize);\n      setLoading(false);\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col items-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-w-[200px] h-[700px] border-4 border-white rounded-md flex items-center justify-center relative\",\n      children: [imgData && /*#__PURE__*/_jsxDEV(\"img\", {\n        src: imgData,\n        ref: imageRef,\n        alt: \"Target\",\n        className: \"h-full object-contain\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 11\n      }, this), !isEmptyPredictions && predictions.map((prediction, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute border-4 border-green-500\",\n        style: {\n          left: `${prediction.bbox[0]}px`,\n          top: `${prediction.bbox[1]}px`,\n          width: `${prediction.bbox[2]}px`,\n          height: `${prediction.bbox[3]}px`\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute -top-6 left-0 text-green-500 font-medium text-base\",\n          children: `${prediction.class} ${prediction.score.toFixed(1)}%`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 15\n        }, this)\n      }, idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      ref: fileInputRef,\n      onChange: onSelectImage,\n      className: \"hidden\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: openFilePicker,\n      className: \"mt-8 px-4 py-2 border-2 border-transparent bg-white text-[#0a0f22] text-lg font-medium transition-all duration-200 hover:bg-transparent hover:border-white hover:text-white\",\n      children: isLoading ? \"Recognizing...\" : \"Select Image\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n}\n_s(ObjectDetector, \"0F6IHk0iAC0fXk38QmgjuiDnL9Y=\");\n_c = ObjectDetector;\nvar _c;\n$RefreshReg$(_c, \"ObjectDetector\");","map":{"version":3,"names":["React","useRef","useState","cocoSsd","jsxDEV","_jsxDEV","ObjectDetector","_s","fileInputRef","imageRef","imgData","setImgData","predictions","setPredictions","isLoading","setLoading","isEmptyPredictions","length","openFilePicker","_fileInputRef$current","current","click","normalizePredictions","imgSize","imgWidth","width","imgHeight","height","map","prediction","oldX","oldY","oldWidth","oldHeight","bbox","x","y","class","score","detectObjectsOnImage","imageElement","model","load","detect","normalized","console","log","readImage","file","Promise","resolve","reject","fileReader","FileReader","onload","result","onerror","error","readAsDataURL","onSelectImage","e","_e$target$files","target","files","document","createElement","src","className","children","ref","alt","fileName","_jsxFileName","lineNumber","columnNumber","idx","style","left","top","toFixed","type","onChange","onClick","_c","$RefreshReg$"],"sources":["/home/yorick/my-page/src/components/objectDetector/index.tsx"],"sourcesContent":["import React, { useRef, useState, ChangeEvent } from \"react\";\n\nimport \"@tensorflow/tfjs-backend-cpu\";\n// import \"@tensorflow/tfjs-backend-webgl\";\nimport * as cocoSsd from \"@tensorflow-models/coco-ssd\";\nimport { ObjectDetection } from \"@tensorflow-models/coco-ssd\";\n\ninterface Prediction {\n  bbox: [number, number, number, number];\n  class: string;\n  score: number;\n}\n\nexport function ObjectDetector() {\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const imageRef = useRef<HTMLImageElement | null>(null);\n\n  const [imgData, setImgData] = useState<string | null>(null);\n  const [predictions, setPredictions] = useState<Prediction[]>([]);\n  const [isLoading, setLoading] = useState(false);\n\n  const isEmptyPredictions = !predictions || predictions.length === 0;\n\n  const openFilePicker = () => {\n    fileInputRef.current?.click();\n  };\n\n  const normalizePredictions = (\n    predictions: cocoSsd.DetectedObject[],\n    imgSize: { width: number; height: number }\n  ): Prediction[] => {\n    if (!predictions || !imgSize || !imageRef.current) return [];\n\n    const imgWidth = imageRef.current.width;\n    const imgHeight = imageRef.current.height;\n\n    return predictions.map((prediction) => {\n      const [oldX, oldY, oldWidth, oldHeight] = prediction.bbox;\n\n      const x = (oldX * imgWidth) / imgSize.width;\n      const y = (oldY * imgHeight) / imgSize.height;\n      const width = (oldWidth * imgWidth) / imgSize.width;\n      const height = (oldHeight * imgHeight) / imgSize.height;\n\n      return {\n        class: prediction.class,\n        score: prediction.score,\n        bbox: [x, y, width, height],\n      };\n    });\n  };\n\n  const detectObjectsOnImage = async (\n    imageElement: HTMLImageElement,\n    imgSize: { width: number; height: number }\n  ) => {\n    const model: ObjectDetection = await cocoSsd.load();\n    const predictions = await model.detect(imageElement, 6);\n    const normalized = normalizePredictions(predictions, imgSize);\n    setPredictions(normalized);\n    console.log(\"Predictions: \", predictions);\n  };\n\n  const readImage = (file: File): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      const fileReader = new FileReader();\n      fileReader.onload = () => resolve(fileReader.result as string);\n      fileReader.onerror = () => reject(fileReader.error);\n      fileReader.readAsDataURL(file);\n    });\n  };\n\n  const onSelectImage = async (e: ChangeEvent<HTMLInputElement>) => {\n    setPredictions([]);\n    setLoading(true);\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const imgData = await readImage(file);\n    setImgData(imgData);\n\n    const imageElement = document.createElement(\"img\");\n    imageElement.src = imgData;\n\n    imageElement.onload = async () => {\n      const imgSize = {\n        width: imageElement.width,\n        height: imageElement.height,\n      };\n      await detectObjectsOnImage(imageElement, imgSize);\n      setLoading(false);\n    };\n  };\n\n  return (\n    <div className=\"flex flex-col items-center\">\n      <div className=\"min-w-[200px] h-[700px] border-4 border-white rounded-md flex items-center justify-center relative\">\n        {imgData && (\n          <img\n            src={imgData}\n            ref={imageRef}\n            alt=\"Target\"\n            className=\"h-full object-contain\"\n          />\n        )}\n        {!isEmptyPredictions &&\n          predictions.map((prediction, idx) => (\n            <div\n              key={idx}\n              className=\"absolute border-4 border-green-500\"\n              style={{\n                left: `${prediction.bbox[0]}px`,\n                top: `${prediction.bbox[1]}px`,\n                width: `${prediction.bbox[2]}px`,\n                height: `${prediction.bbox[3]}px`,\n              }}\n            >\n              <div className=\"absolute -top-6 left-0 text-green-500 font-medium text-base\">\n                {`${prediction.class} ${prediction.score.toFixed(1)}%`}\n              </div>\n            </div>\n          ))}\n      </div>\n\n      <input\n        type=\"file\"\n        ref={fileInputRef}\n        onChange={onSelectImage}\n        className=\"hidden\"\n      />\n\n      <button\n        onClick={openFilePicker}\n        className=\"mt-8 px-4 py-2 border-2 border-transparent bg-white text-[#0a0f22] text-lg font-medium transition-all duration-200 hover:bg-transparent hover:border-white hover:text-white\"\n      >\n        {isLoading ? \"Recognizing...\" : \"Select Image\"}\n      </button>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}